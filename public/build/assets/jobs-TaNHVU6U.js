let d=null,I=!1;window.openJobModal=fe;window.closeJobModal=me;window.openServiceModal=ge;window.closeServiceModal=ye;window.openServiceRequestModal=ee;window.closeServiceRequestModal=pe;window.openJobRequestModal=be;window.closeJobRequestModal=we;window.openJobDetailModal=Q;window.closeJobDetailModal=re;window.openServiceDetailModal=X;window.closeServiceDetailModal=ae;window.editJob=he;window.editService=Se;window.deleteJob=V;window.deleteService=W;window.requestService=ve;window.completeJob=Me;window.openModal=m;window.closeModal=c;window.toggleFilters=de;document.addEventListener("DOMContentLoaded",function(){console.log("DOM loaded - initializing jobs system..."),Z(),Ee(),Ce(),le(),se(),U(),te(),new ne,console.log("Jobs.js initialized successfully")});window.addEventListener("load",function(){I||(console.log("Window loaded - fallback initialization..."),Z(),U())});const $={clean:{icon:!1,iconHtml:"",buttonsStyling:!0,allowOutsideClick:!0,allowEscapeKey:!0,showClass:{popup:"animate__animated animate__fadeInDown animate__faster"},hideClass:{popup:"animate__animated animate__fadeOutUp animate__faster"}},confirmation:{showCancelButton:!0,reverseButtons:!0,focusCancel:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d"},success:{confirmButtonColor:"#28a745",timer:3e3,timerProgressBar:!0,showCancelButton:!1},error:{confirmButtonColor:"#dc3545",showCancelButton:!1},loading:{allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1}};function f(e,o={}){const t={...$.clean},n=$[e]||{};return{...t,...n,...o}}function U(){console.log("Setting up delete system..."),document.removeEventListener("click",_),document.addEventListener("click",_),console.log("Delete system initialized successfully"),setTimeout(()=>{Y()},1e3)}function Y(){console.log("=== DELETE BUTTONS DEBUG ===");const e=document.querySelectorAll(".job-delete-btn"),o=document.querySelectorAll(".service-delete-btn"),t=document.querySelectorAll("[data-job-id], [data-service-id]");console.log("Job delete buttons (.job-delete-btn):",e.length),e.forEach((n,l)=>{console.log(`  Job button ${l}:`,{element:n,className:n.className,jobId:n.getAttribute("data-job-id"),jobTitle:n.getAttribute("data-job-title"),onclick:n.getAttribute("onclick")})}),console.log("Service delete buttons (.service-delete-btn):",o.length),o.forEach((n,l)=>{console.log(`  Service button ${l}:`,{element:n,className:n.className,serviceId:n.getAttribute("data-service-id"),serviceTitle:n.getAttribute("data-service-title"),onclick:n.getAttribute("onclick")})}),console.log("All data attribute buttons:",t.length),t.forEach((n,l)=>{console.log(`  Data button ${l}:`,{element:n,className:n.className,jobId:n.getAttribute("data-job-id"),serviceId:n.getAttribute("data-service-id")})}),console.log("CSRF token available:",L()?"YES":"NO"),console.log("SweetAlert available:",typeof Swal<"u"?"YES":"NO"),console.log("========================")}function _(e){const o=e.target,t=o.closest("button")||o;if(console.log("=== CLICK EVENT DEBUG ==="),console.log("Target element:",o),console.log("Target classes:",o.className),console.log("Button element:",t),console.log("Button classes:",t?t.className:"N/A"),t&&(t.classList.contains("job-delete-btn")||t.getAttribute("data-job-id"))){console.log("✅ Job delete button detected!"),e.preventDefault(),e.stopPropagation();const n=t.getAttribute("data-job-id"),l=t.getAttribute("data-job-title")||"this job";console.log("Job delete - ID:",n,"Title:",l),n?V(n,l):console.error("❌ Job ID not found!");return}if(t&&(t.classList.contains("service-delete-btn")||t.getAttribute("data-service-id"))){console.log("✅ Service delete button detected!"),e.preventDefault(),e.stopPropagation();const n=t.getAttribute("data-service-id"),l=t.getAttribute("data-service-title")||"this service";console.log("Service delete - ID:",n,"Title:",l),n?W(n,l):console.error("❌ Service ID not found!");return}console.log("❌ No delete button detected"),console.log("======================")}function V(e,o="this job"){if(console.log("🗑️ deleteJob called with:",e,o),typeof Swal>"u"){console.log("⚠️ SweetAlert not available, using confirm"),confirm(`Are you sure you want to delete ${o}? This action cannot be undone.`)&&R(e);return}const t=f("confirmation",{title:"Delete Job?",text:`Are you sure you want to delete "${o}"? This action cannot be undone and will permanently remove the job and all its requests.`,confirmButtonText:"Yes, Delete Job",cancelButtonText:"Cancel"});Swal.fire(t).then(n=>{console.log("SweetAlert result:",n),n.isConfirmed&&(B("Deleting Job...","Please wait while we delete the job."),R(e))}).catch(n=>{console.error("SweetAlert error:",n),confirm(`Are you sure you want to delete ${o}? This action cannot be undone.`)&&R(e)})}function W(e,o="this service"){if(console.log("🗑️ deleteService called with:",e,o),typeof Swal>"u"){console.log("⚠️ SweetAlert not available, using confirm"),confirm(`Are you sure you want to delete ${o}? This action cannot be undone.`)&&N(e);return}const t=f("confirmation",{title:"Delete Service?",text:`Are you sure you want to delete "${o}"? This action cannot be undone and will permanently remove the service and all its requests.`,confirmButtonText:"Yes, Delete Service",cancelButtonText:"Cancel"});Swal.fire(t).then(n=>{console.log("SweetAlert result:",n),n.isConfirmed&&(B("Deleting Service...","Please wait while we delete the service."),N(e))}).catch(n=>{console.error("SweetAlert error:",n),confirm(`Are you sure you want to delete ${o}? This action cannot be undone.`)&&N(e)})}function R(e){console.log("📤 Submitting job delete form for ID:",e);const o=L();if(!o){console.error("❌ CSRF token not found!"),u("CSRF token not found. Please refresh the page and try again.");return}console.log("✅ CSRF token found:",o.substring(0,10)+"...");const t=document.createElement("form");t.method="POST",t.action=`/jobs/${e}`,t.style.display="none";const n=document.createElement("input");n.type="hidden",n.name="_token",n.value=o,t.appendChild(n);const l=document.createElement("input");l.type="hidden",l.name="_method",l.value="DELETE",t.appendChild(l),document.body.appendChild(t),console.log("📋 Form created:"),console.log("  Action:",t.action),console.log("  Method:",t.method),console.log("  CSRF Token:",n.value.substring(0,10)+"..."),console.log("  Method Override:",l.value);try{t.submit(),console.log("✅ Form submitted successfully")}catch(s){console.error("❌ Error submitting form:",s),u("An error occurred while deleting. Please try again."),document.body.removeChild(t)}}function N(e){console.log("📤 Submitting service delete form for ID:",e);const o=L();if(!o){console.error("❌ CSRF token not found!"),u("CSRF token not found. Please refresh the page and try again.");return}console.log("✅ CSRF token found:",o.substring(0,10)+"...");const t=document.createElement("form");t.method="POST",t.action=`/services/${e}`,t.style.display="none";const n=document.createElement("input");n.type="hidden",n.name="_token",n.value=o,t.appendChild(n);const l=document.createElement("input");l.type="hidden",l.name="_method",l.value="DELETE",t.appendChild(l),document.body.appendChild(t),console.log("📋 Form created:"),console.log("  Action:",t.action),console.log("  Method:",t.method),console.log("  CSRF Token:",n.value.substring(0,10)+"..."),console.log("  Method Override:",l.value);try{t.submit(),console.log("✅ Form submitted successfully")}catch(s){console.error("❌ Error submitting form:",s),u("An error occurred while deleting. Please try again."),document.body.removeChild(t)}}function L(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return e.getAttribute("content");const o=document.querySelector('input[name="_token"]');return o?o.value:(console.error("CSRF token not found in meta tag or form!"),null)}function B(e,o){if(typeof Swal>"u")return;const t=f("loading",{title:e,text:o,didOpen:()=>{Swal.showLoading()}});Swal.fire(t)}function G(e){if(console.log("📢 Showing success message:",e),typeof Swal>"u"){alert(e);return}const o=f("success",{title:"Success!",text:e});Swal.fire(o)}function u(e){if(console.log("⚠️ Showing error message:",e),typeof Swal>"u"){alert(e);return}const o=f("error",{title:"Error",text:e});Swal.fire(o)}function K(e,o="Information"){if(console.log("ℹ️ Showing info message:",e),typeof Swal>"u"){alert(e);return}const t=f("clean",{title:o,text:e,confirmButtonColor:"#007bff",showCancelButton:!1});Swal.fire(t)}function H(e,o="Warning"){if(console.log("⚠️ Showing warning message:",e),typeof Swal>"u"){alert(e);return}const t=f("clean",{title:o,text:e,confirmButtonColor:"#ffc107",showCancelButton:!1});Swal.fire(t)}function te(){console.log("🔍 Checking for session messages...");const e=document.querySelector("[data-session-success]");if(e){const l=e.getAttribute("data-session-success");l&&(console.log("✅ Found session success message:",l),G(l))}const o=document.querySelector("[data-session-error]");if(o){const l=o.getAttribute("data-session-error");l&&(console.log("❌ Found session error message:",l),u(l))}const t=document.querySelector("[data-session-info]");if(t){const l=t.getAttribute("data-session-info");l&&(console.log("ℹ️ Found session info message:",l),K(l))}const n=document.querySelector("[data-session-warning]");if(n){const l=n.getAttribute("data-session-warning");l&&(console.log("⚠️ Found session warning message:",l),H(l))}}class ne{constructor(){this.activeModal=null,this.init()}init(){this.setupEventListeners()}setupEventListeners(){document.addEventListener("click",t=>{t.target.classList.contains("modal")&&t.target.style.display==="flex"&&this.closeModal(t.target.id)}),document.addEventListener("keydown",t=>{t.key==="Escape"&&this.activeModal&&this.closeModal(this.activeModal)}),document.querySelectorAll(".modal-close").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const l=t.closest(".modal");l&&this.closeModal(l.id)})})}openModal(o){this.activeModal&&this.closeModal(this.activeModal);const t=document.getElementById(o);if(!t){console.error("Modal not found:",o);return}t.style.display="flex",t.classList.add("modal-open"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",document.body.classList.add("modal-open"),this.activeModal=o,setTimeout(()=>{const n=t.querySelector("input, textarea, select");n&&n.focus()},100)}closeModal(o){const t=document.getElementById(o);if(!t){console.error("Modal not found:",o);return}t.style.display="none",t.classList.remove("modal-open"),t.setAttribute("aria-hidden","true"),document.body.style.overflow="",document.body.classList.remove("modal-open"),this.activeModal===o&&(this.activeModal=null);const n=t.querySelector("form");n&&(n.reset(),n.querySelectorAll(".error").forEach(s=>{s.classList.remove("error"),s.style.borderColor=""}))}}function le(){document.addEventListener("click",function(e){const o=e.target.closest(".job-card");if(o&&!e.target.closest(".job-actions")&&!e.target.closest("button")&&!e.target.closest("a")){const t=ie(o);t&&Q(t)}})}function se(){document.addEventListener("click",function(e){const o=e.target.closest(".service-card");if(o&&!e.target.closest(".service-actions")&&!e.target.closest("button")&&!e.target.closest("a")){const t=ce(o);t&&X(t)}})}function ie(e){var o,t,n,l,s,p,b,w,h,S,v,M,E,C,q,A,k,x,g;try{const a=(t=(o=e.querySelector(".job-header h3"))==null?void 0:o.textContent)==null?void 0:t.trim();let r="";const y=e.querySelector(".job-description");y&&(r=((n=y.textContent)==null?void 0:n.trim())||"",r=y.getAttribute("data-full-description")||y.getAttribute("title")||r);const F=(s=(l=e.querySelector(".job-status"))==null?void 0:l.textContent)==null?void 0:s.trim(),J=(w=(b=(p=e.querySelector(".client-info"))==null?void 0:p.textContent)==null?void 0:b.replace("Client:",""))==null?void 0:w.trim(),T=(S=(h=e.querySelector(".category"))==null?void 0:h.textContent)==null?void 0:S.trim(),D=(M=(v=e.querySelector(".budget"))==null?void 0:v.textContent)==null?void 0:M.trim(),j=(C=(E=e.querySelector(".location"))==null?void 0:E.textContent)==null?void 0:C.trim(),O=(A=(q=e.querySelector(".deadline"))==null?void 0:q.textContent)==null?void 0:A.trim(),oe=(g=(x=(k=e.querySelector(".assigned-professional"))==null?void 0:k.textContent)==null?void 0:x.replace("Assigned to:",""))==null?void 0:g.trim();return{title:a,description:r,status:F,clientName:J,category:T,budget:D,location:j,deadline:O,assignedProfessional:oe}}catch(a){return console.error("Error extracting job data:",a),null}}function ce(e){var o,t,n,l,s,p,b,w,h,S,v,M,E,C,q,A,k,x;try{const g=(t=(o=e.querySelector(".service-header h3"))==null?void 0:o.textContent)==null?void 0:t.trim();let a="";const r=e.querySelector(".service-description");r&&(a=((n=r.textContent)==null?void 0:n.trim())||"",a=r.getAttribute("data-full-description")||r.getAttribute("title")||a);const y=(s=(l=e.querySelector(".service-status"))==null?void 0:l.textContent)==null?void 0:s.trim(),F=((b=(p=e.querySelector(".professional-info strong"))==null?void 0:p.textContent)==null?void 0:b.trim())||((S=(h=(w=e.querySelector(".professional-info"))==null?void 0:w.textContent)==null?void 0:h.replace("Professional:",""))==null?void 0:S.trim()),J=(M=(v=e.querySelector(".specialization"))==null?void 0:v.textContent)==null?void 0:M.trim(),T=(C=(E=e.querySelector(".category"))==null?void 0:E.textContent)==null?void 0:C.trim(),D=(A=(q=e.querySelector(".price"))==null?void 0:q.textContent)==null?void 0:A.trim(),j=(x=(k=e.querySelector(".service-area"))==null?void 0:k.textContent)==null?void 0:x.trim();return{title:g,description:a,status:y,professionalName:F,specialization:J,category:T,price:D,serviceArea:j}}catch(g){return console.error("Error extracting service data:",g),null}}function Q(e){console.log("Opening job detail modal with data:",e);const o=document.getElementById("jobDetailModal");if(!o){console.error("Job detail modal not found");return}i(o,".modal-job-title",e.title),i(o,".modal-job-description",e.description),i(o,".modal-job-status",e.status),i(o,".modal-job-client",e.clientName),i(o,".modal-job-category",e.category),i(o,".modal-job-budget",e.budget),i(o,".modal-job-location",e.location),i(o,".modal-job-deadline",e.deadline),i(o,".modal-job-assigned",e.assignedProfessional);const t=o.querySelector(".modal-job-client-link");t&&e.clientName&&(t.textContent=e.clientName,t.style.display="inline");const n=o.querySelector(".modal-job-assigned-link"),l=o.querySelector(".modal-job-assigned-section");n&&e.assignedProfessional?(n.textContent=e.assignedProfessional,n.style.display="inline",l.style.display="block"):l&&(l.style.display="none"),m("jobDetailModal")}function re(){console.log("Closing job detail modal"),c("jobDetailModal")}function X(e){console.log("Opening service detail modal with data:",e);const o=document.getElementById("serviceDetailModal");if(!o){console.error("Service detail modal not found");return}i(o,".modal-service-title",e.title),i(o,".modal-service-description",e.description),i(o,".modal-service-status",e.status),i(o,".modal-service-professional",e.professionalName),i(o,".modal-service-specialization",e.specialization),i(o,".modal-service-category",e.category),i(o,".modal-service-price",e.price),i(o,".modal-service-area",e.serviceArea);const t=o.querySelector(".modal-service-professional-link");t&&e.professionalName&&(t.textContent=e.professionalName,t.style.display="inline"),m("serviceDetailModal")}function ae(){console.log("Closing service detail modal"),c("serviceDetailModal")}function i(e,o,t){const n=e.querySelector(o);n&&t?(n.textContent=t,n.style.display="block"):n&&(n.style.display="none")}function de(e){console.log("Toggling filters:",e);const o=document.getElementById(e);if(!o){console.error("Filters container not found:",e);return}o.style.display==="none"||o.style.display===""?(o.style.display="block",o.classList.add("filters-open")):(o.style.display="none",o.classList.remove("filters-open"))}function Z(){console.log("Initializing modals..."),document.querySelectorAll(".modal").forEach(o=>{o.style.display="none",o.classList.remove("modal-open"),o.setAttribute("aria-hidden","true")}),ue(),document.body.style.overflow="",document.body.classList.remove("modal-open"),I=!0,console.log("Modals initialized successfully")}function ue(){document.addEventListener("click",function(o){o.target.classList.contains("modal")&&o.target.style.display==="flex"&&c(o.target.id)}),document.addEventListener("keydown",function(o){o.key==="Escape"&&d&&c(d)}),document.querySelectorAll(".modal-close").forEach(o=>{o.addEventListener("click",function(t){t.preventDefault();const n=this.closest(".modal");n&&c(n.id)})})}function m(e){console.log("Opening modal:",e),d&&c(d);const o=document.getElementById(e);if(!o){console.error("Modal not found:",e);return}o.style.display="flex",o.classList.add("modal-open"),o.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",document.body.classList.add("modal-open"),d=e,setTimeout(()=>{const t=o.querySelector("input, textarea, select");t&&t.focus()},100),console.log("Modal opened:",e)}function c(e){console.log("Closing modal:",e);const o=document.getElementById(e);if(!o){console.error("Modal not found:",e);return}o.style.display="none",o.classList.remove("modal-open"),o.setAttribute("aria-hidden","true"),document.body.style.overflow="",document.body.classList.remove("modal-open"),d===e&&(d=null);const t=o.querySelector("form");t&&(t.reset(),t.querySelectorAll(".error").forEach(l=>{l.classList.remove("error"),l.style.borderColor=""})),console.log("Modal closed:",e)}function fe(){console.log("openJobModal called"),m("jobModal")}function me(){console.log("closeJobModal called"),c("jobModal")}function ge(){console.log("openServiceModal called"),m("serviceModal")}function ye(){console.log("closeServiceModal called"),c("serviceModal")}function ee(){console.log("openServiceRequestModal called"),m("serviceRequestModal")}function pe(){console.log("closeServiceRequestModal called"),c("serviceRequestModal")}function be(e){console.log("openJobRequestModal called with jobId:",e);const o=document.getElementById("jobRequestForm");o?(o.action=`/jobs/${e}/request`,console.log("Form action set to:",o.action)):console.error("Job request form not found!"),m("jobRequestModal")}function we(){console.log("closeJobRequestModal called"),c("jobRequestModal")}function he(e){console.log("Editing job:",e),window.location.href=`/jobs/${e}/edit`}function Se(e){console.log("Editing service:",e),window.location.href=`/services/${e}/edit`}function ve(e){console.log("Requesting service:",e);const o=document.getElementById("serviceRequestForm");o&&(o.action=`/services/${e}/request`),ee()}function Me(e){if(console.log("Completing job:",e),typeof Swal>"u"){confirm("Are you sure you want to mark this job as complete?")&&z("POST",`/jobs/${e}/complete`);return}const o=f("confirmation",{title:"Mark as Completed?",text:"Are you sure you want to mark this job as complete?",confirmButtonText:"Yes, Complete Job!",cancelButtonText:"Cancel",confirmButtonColor:"#28a745"});Swal.fire(o).then(t=>{t.isConfirmed&&(B("Completing Job...","Please wait while we update the job status."),z("POST",`/jobs/${e}/complete`))})}function z(e,o){const t=L();if(!t){u("CSRF token not found. Please refresh the page and try again.");return}const n=document.createElement("form");n.method="POST",n.action=o;const l=document.createElement("input");l.type="hidden",l.name="_token",l.value=t,n.appendChild(l),document.body.appendChild(n),n.submit()}function Ee(){document.querySelectorAll("form").forEach(o=>{const t=o.querySelectorAll("[required]");t.forEach(n=>{n.addEventListener("blur",function(){P(this)}),n.addEventListener("input",function(){this.classList.contains("error")&&P(this)})}),o.addEventListener("submit",function(n){let l=!0;if(t.forEach(s=>{P(s)||(l=!1)}),!l){n.preventDefault(),u("Please fill in all required fields correctly.");const s=o.querySelector(".error");s&&s.focus()}})})}function P(e){const o=e.value.trim();let t=!0;if(e.classList.remove("error"),e.style.borderColor="",e.hasAttribute("required")&&!o&&(t=!1),e.type==="email"&&o&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)||(t=!1)),e.type==="number"&&o){const n=e.getAttribute("min");n&&parseFloat(o)<parseFloat(n)&&(t=!1)}return t||(e.classList.add("error"),e.style.borderColor="#dc3545"),t}function Ce(){document.querySelectorAll("textarea").forEach(o=>{o.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"})})}function qe(){console.log("=== MODAL DEBUG ==="),document.querySelectorAll(".modal").forEach((o,t)=>{console.log(`Modal ${t+1} (${o.id}):`),console.log("  Display:",window.getComputedStyle(o).display),console.log("  Classes:",o.className),console.log("  Active Modal:",d)}),console.log("==================")}window.debugDeleteSystem=function(){Y()};window.debugModals=qe;window.showSuccess=G;window.showError=u;window.showInfo=K;window.showWarning=H;window.showLoadingModal=B;console.log("Complete Jobs.js loaded successfully - all functions including consistent modals are now available globally");
